# ロボット用の環境のセットアップ

Written by: 水野 on 2018/05/11

## 概要

田所研には実験用の小型ロボットが何種類かある．これらのロボットをジョイパッド（ゲームコントローラ）で動かすことができるようにする手順を説明する．

## 田所研に生息するロボットたち

これらのロボットは全てROSを使って動かすことができる．

### ビーゴ

B5用紙のサイズであることからビーゴと呼ばれる．

TODO: スペック（センサ，モータ，バッテリの持続時間）
TODO: 写真

### メカノさん

ビーゴよりも大きい対向二輪型のロボット．

TODO: 写真，スペック

### コムス

トヨタ車体の電気自動車コムスを，自動運転できるように改造したもの．コムスに関しては，車両に専用のボードPCが搭載されているため，ここでの解説は割愛する．

TODO: Hacking COMSへのリンク

## セットアップ手順

条件: UbuntuとROSがインストールされていること．インストール方法については[ここ](install.md)を参照すること．

TODO: リンク先を確認

1. `mkdir ~/ros/workspaces/kinetic/ros_intro`
  - ワークスペースを作成する
  - `~/ros/workspaces/ROSディストロ名/ワークスペース名` に作るのがオススメ
2. 作成したワークスペースに `cd` で入る
3. `git clone https://github.com/tadolab/sh_spur_ros ./src/sh_spur_ros`
  - `sh_spur_ros` はモータのドライバ
  - `git clone` はGitHubからダウンロードするためのコマンド
4. 各ロボットに必要な他のパッケージをダウンロード
  - ビーゴの場合: [ここ](beego.md)のセットアップを参照
  - メカノさんの場合: [ここ](mechano.md)のセットアップを参照
5. `catkin_make` を実行
6. 起動の仕方については，上記の各ロボットのページにある起動を参照する

## ジョイパッドを使ったロボットの操作

前節が終了した段階で，速度指令を受け付ける状態になっているはずである．そのため，あとはジョイパッドの入力を速度の指令値に変換するだけで良い．これには `teleop_twist_joy` を使用すると楽．

```
$ sudo apt-get install ros-kinetic-teleop-twist-joy
$ roslaunch teleop_twist_joy ps3.launch
```

`enable` ボタン（PS3だとスティック押し込みだが，ジョイパッドによる）を押しながらスティックを倒すことで速度指令が送られる．

設定ファイルは `/opt/ros/kinetic/share/teleop_twist_joy/config/ps3.config` にある．設定ファイルでは，以下の項目が変更できる:

- どのボタンを `enable` ボタンに設定するか
- どのスティックが使われるか（デフォルトだと左のスティック）
- スティックの感度
- etc.

ロボットを動かす際に，

```
$ rosrun rviz rviz
```

でrvizを立ち上げ，Global Frameを `odom` にし，左下のAddから `TF` を追加する．ロボットを動かした際に `base_link` が動くことが確認できれば完了．

## トラブルシューティング

### レーザスキャンが表示されない

```
$ rostopic list
```

出力されるトピック一覧の中に `/scan` が含まれることを確認する．

### `base_link` が動かない

```
$ rosrun rqt_tf_tree rqt_tf_tree
```

出力されるTFツリーに `odom` から `base_link` への変換が含まれているかを確認する．
